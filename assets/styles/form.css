/*----------------------------*/
/* FORM */
/*----------------------------*/



/*----------------------------*/
/* GENERAL */
/*----------------------------*/

.form-group {
  input,
  textarea {
    @apply
    text-ui-100
    placeholder:text-ui-300
    ;
  }
}

.form-group > label:not(.form-radio):not(.form-checkbox):not(.form-toggle):not(.button),
.label {
  @apply
  text-sm
  uppercase
  font-bold
  ;
  &:not([class*="text-ui"]) {
    @apply
    text-ui-200
    ;
  }
}
.form-group > label:not(.form-radio):not(.form-checkbox):not(.form-toggle):not(.button) {
  @apply
  block
  mb-1
  ;
}

.is-disabled {
  @apply
  cursor-not-allowed
  opacity-50
  ;
  &,
  * {
    @apply
    pointer-events-none
    ;
  }
}

/*----------------------------*/
/* TEXT INPUTS */
/*----------------------------*/

.form-group {
  :where(input[type=text], input[type=number], input[type=email], input[type=password], input[type=date], input[type=file], textarea, .input-text, select) {
    @apply
    block
    ;
  }

  :where(input[type=text], input[type=number], input[type=email], input[type=password], input[type=date], input[type=file], textarea, .input-text, .form-select > select) {
    @apply
    w-full
    shadow-sm
    bg-ui-700
    border
    border-ui-500
    focus-visible:outline
    focus-visible:outline-1
    focus-visible:outline-ui-300
    focus-visible:z-20
    p-2
    ;

    &.input-sm {
      @apply
      p-[0.4375rem]
      text-sm
      ;
    }
  }

  > :where(input[type=text], input[type=number], input[type=email], input[type=password], input[type=date], input[type=file], textarea, .input-text, .form-select > select) {
    &:not([class*="rounded-"]) {
      @apply
      rounded
      ;
    }
  }
  
}


/*----------------------------*/
/* SELECT INPUTS */
/*----------------------------*/

.form-select {
  @apply
  relative
  ;

  select {
    &:not([multiple]) {
      @apply
      appearance-none
      pr-8
      overflow-hidden
      bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTExLjk5OTkgMTUuMDAwMUMxMS43NDM5IDE1LjAwMDEgMTEuNDg3OSAxNC45MDIxIDExLjI5MjkgMTQuNzA3MUw2LjU4NTk0IDEwLjAwMDFMNy45OTk5NCA4LjU4NjA2TDExLjk5OTkgMTIuNTg2MUwxNS45OTk5IDguNTg2MDZMMTcuNDEzOSAxMC4wMDAxTDEyLjcwNjkgMTQuNzA3MUMxMi41MTE5IDE0LjkwMjEgMTIuMjU1OSAxNS4wMDAxIDExLjk5OTkgMTUuMDAwMVoiIGZpbGw9IiM4NTg1QUQiLz4KPC9zdmc+Cg==')]
      bg-no-repeat
      bg-[calc(100%-0.25rem)_center]
      ;      
    }
    &[multiple] {
      @apply
      h-auto
      relative
      pr-0.5
      py-2
      space-y-0.5
      ;
      > option {
        @apply
        py-1.5
        
        ;
  
        &:checked {
          @apply
          bg-interaction-500
          rounded-sm
          text-ui-800
          ;
        }
      }

      &:focus {
        > option {
          &:checked {
            @apply
            bg-interaction-300
            ;
          }
        }
      }
    }
  
    option {
      &:disabled {
        @apply
        text-ui-300
        ;
      }
    }
  }
}

/*----------------------------*/
/* FILE */
/*----------------------------*/

:where(.form-group, .form-dropzone) {
  input[type=file] {
    @apply
    p-0
    min-h-[42px]
    file:min-h-[42px]
    file:bg-ui-600
    file:hover:bg-ui-500
    file:cursor-pointer
    file:px-4
    file:rounded-l-sm 
    file:border-0
    file:font-bold  
    file:text-ui-100
    file:mr-2
    block
    w-full
    text-sm
    text-ui-300
    cursor-pointer
    focus:outline-none
    ;
  }
}


label.button {
  + input[type=file] {
    @apply
    h-px
    w-px
    -m-px
    opacity-0
    overflow-hidden
    min-h-[0px]
    ;
    clip: rect(0px, 0px, 0px, 0px);
  }
}

/*----------------------------*/
/* RADIO, CHECKBOX, TOGGLE */
/*----------------------------*/

:where(.form-radio,.form-checkbox, .form-toggle) {
  @apply
  flex
  relative
  select-none
  ;

  label {
    @apply
    pl-14
    py-2
    pr-2
    cursor-pointer
    min-h-[24px]
    min-w-[24px]
    rounded
    ;
  }

  &.is-disabled {
    @apply
    cursor-not-allowed
    opacity-50
    ;
    &,
    * {
      @apply
      pointer-events-none
      ;
    }
  }

  &:is(li) {
    label {
      @apply
      w-full
      transition-all
      duration-200
      ease-[cubic-bezier(.7,0,.3,1)]
      hover:bg-ui-700
      ;
    }
  }


  /* generic */

  input {
    @apply
    h-px
    w-px
    -m-px
    opacity-0
    overflow-hidden
    ;
    clip: rect(0px, 0px, 0px, 0px);

    &:checked {
      + label {
        &::before {
          @apply
          bg-interaction-500
          shadow-[0_0_0_1px_rgb(var(--color-interaction-300))]
          ;
        }
      }
    }
  }

  label {
    @apply
    flex
    items-center
    ;
    &::before,
    &::after {
      @apply
      content-['']
      absolute
      overflow-hidden
      block
      left-0
      my-auto
      transition-all
      transform-gpu
      duration-300
      ease-[cubic-bezier(.9,0,.2,1)]
      shadow-[0_0_0_1px_rgb(var(--color-ui-600))]
      ;
    }
    &::before {
      @apply
      shadow-[0_0_0_1px_rgb(var(--color-ui-600))]
      ;
    }
    &::after {
      @apply
      absolute
      ;
    }
  }

  input:checked {
    + label {
      &::before {
        @apply
        bg-gradient-to-b
        from-interaction-700
        to-interaction-300
        shadow-[0_0_0_2px_rgb(var(--color-interaction-300))]
        ;
      }
    }
  }
  input:not(:checked) {
    + label {
      &::before {
        @apply
        bg-ui-700
        shadow-[0_0_0_1px_rgb(var(--color-ui-500))]
        ;
      }
    }
  }

  &:not([disabled]),
  &:not(.is-disabled) {
    &:focus-visible {
      input {
        + label {
          &::before {
            @apply
            outline
            outline-offset-2
            outline-ui-500
            ;
          }
        }
      }
      input:checked {
        + label {
          &::before {
            @apply
            outline
            outline-interaction-300
            ;
          }
        }
      }
    }
  }

  /* radio */

  &.form-radio {
    label {
      &::before {
        @apply
        h-6
        w-6
        rounded-full
        shadow-[0_0_0_1px_rgb(var(--color-ui-400))]
        left-3
        ;
      }
      &::after {
        @apply
        w-4
        h-4
        rounded-full
        left-4
        ;
      }
    }

    input:not(:checked){
      + label {
        &::after {
          @apply
          scale-0
          opacity-0
          bg-gradient-to-b
          from-ui-300
          to-ui-400
          ;
        }
      }
    }

    input:checked {
      + label {
        &::after {
          @apply
          scale-100
          opacity-100
          bg-gradient-to-b
          from-ui-500
          to-ui-800
          ;
        }
      }
    }
  }

  /* toggle */

  &.form-toggle {
    label {
      &::before {
        @apply
        h-6
        w-10
        rounded-full
        shadow-[0_0_0_1px_rgb(var(--color-ui-400))]
        left-1
        ;
      }

      &::after {
        @apply
        w-4
        h-4
        rounded-full
        bg-ui-800
        left-2
        ;
      }
    }

    input:not(:checked){
      + label {
        &::after {
          @apply
          translate-x-0
          bg-gradient-to-b
          from-ui-300
          to-ui-400
          ;
        }
      }
    }

    input:checked {
      + label {
        &::after {
          @apply
          translate-x-4
          bg-gradient-to-b
          from-ui-500
          to-ui-800
          ;
        }
      }
    }
  }

  /* checkbox */

  &.form-checkbox {
    label {
      &::before {
        @apply
        h-6
        w-6
        rounded
        shadow-[0_0_0_1px_rgb(var(--color-ui-400))]
        left-3
        ;
      }

      &::after {
        @apply
        w-4
        h-2.5
        border-[3px]
        shadow-[0_0_0_0_rgb(var(--color-ui-400))]
        border-ui-800/0
        border-l-ui-800
        border-b-ui-800
        left-4
        ;
      }
    }

    input:not(:checked){
      + label {
        &::after {
          @apply
          scale-110
          translate-y-2
          opacity-0
          ;
        }
      }
    }

    input:indeterminate {
      + label {
        &::after {
          @apply
          h-1
          -translate-y-0.5
          border-l-ui-800/0
          ;
        }
      }
    }

    input:checked,
    input:indeterminate {
      + label {
        &::after {
          @apply
          -translate-y-0.5
          -rotate-45
          scale-100
          opacity-100
          ;
        }
      }
    }
  }

  /* align to end */

  &.form-end {
    @apply
    text-right
    justify-end
    ;
    label {
      @apply
      pr-14
      pl-2
      ;
      &::before,
      &::after {
        @apply
        left-auto
        ;
      }
    }
    &.form-radio,
    &.form-checkbox {
      label {
        &::before {
          @apply
          right-3
          ;
        }
        &::after {
          @apply
          right-4
          ;
        }
      }
    }
    &.form-toggle {
      label {
        &::before {
          @apply
          right-1
          ;
        }
        &::after {
          @apply
          right-2
          ;
        }
      }
      input:not(:checked){
        + label {
          &::after {
            @apply
            -translate-x-4
            ;
          }
        }
      }
  
      input:checked {
        + label {
          &::after {
            @apply
            translate-x-0
            ;
          }
        }
      }
    }
  }


  /* focus */

  &:not([disabled]),
  &:not(.is-disabled) {
    label {
      @apply
      cursor-pointer
      ;
    }
    &:focus-visible {
      @apply
      outline-none
      ;
      label {
        @apply
        focus:outline
        focus:outline-offset-2
        focus:outline-1
        focus:outline-main
        ;
      }
    }
  }
}

:where(.form-radio,.form-checkbox, .form-toggle) {
  &.form-image {
    perspective: 1000px;
    @apply
    p-0
    text-0
    cursor-pointer
    ;

    > input {
      ~ div:not(.bg-transparent) {
        @apply
        m-0
        bg-cover
        bg-center
        border-0
        overflow-hidden
        transition-all
        duration-300
        ease-in-out
        origin-center
        opacity-25
        scale-90
        grayscale
        brightness-90
        hover:scale-95
        hover:opacity-50
        hover:grayscale-0
        ;

        &::before,
        &::after {
          @apply
          absolute
          transition-all
          transform-gpu
          ease-[cubic-bezier(0.9,0,0.1,1)]
          duration-300
          w-8
          h-8
          top-2
          right-2
          opacity-0
          -translate-y-4
          ;
        }

        &::after {
          @apply
          content-['']
          duration-700
          rounded-full
          bg-gradient-radial-to-b
          from-interaction-300
          to-interaction-700
          shadow-[0_0_0_2px_rgb(var(--color-interaction-500))]
          border-2
          border-ui-800
          z-0
          ;
        }

        &::before {
          @apply
          duration-1000
          font-icon
          text-ui-800
          content-['\eb24']
          z-10
          text-center
          leading-8
          text-base
          ;
        }
      }
      
      &:checked:not(:disabled) {
        ~ div:not(.bg-transparent) {
          @apply
          opacity-100
          scale-100
          shadow-main
          grayscale-0
          brightness-100
          ;
          &::before,
          &::after {
            @apply
            opacity-100
            translate-y-0
            ;
            
          }
        }
      }
    }
  }
}

/*----------------------------*/
/* INPUT GROUP */
/*----------------------------*/

.input-group {
  @apply
  flex
  relative
  ;
  &:not([class*="rounded-"]) {
    @apply
    rounded
    ;
  }

  /* :where(input[type=text], input[type=number], input[type=email], input[type=password], input[type=date], input[type=file], textarea, button, .button, .button.button-primary) */

  > * {
    @apply
    rounded-none
    ;
    &:first-child {
      @apply
      rounded-l
      ;
      &:is(span, div) {
        @apply
        border-r-0
        ;
      }
    }
    &:last-child {
      @apply
      rounded-r
      ;
      &:is(span, div) {
        @apply
        border-l-0
        ;
      }
    }
  }

  :where(span, div) {
    @apply
    relative
    z-10
    ;
  }

  :where(input, textarea) {
    @apply
    relative
    z-20
    ;
  }

  > :where(.icon, .button) {
    &:first-child {
      @apply
      relative
      z-30
      ;
      + input,
      + textarea {
        @apply
        rounded-l
        border-l
        relative 
        z-10
        ;
      }
    }
  }

  > .button.button-primary {
    &:first-child {
      @apply
      rounded-l-none
      ;
      + input,
      + textarea {
        @apply
        border-r-0
        rounded-r-none
        ;
      }
    }
  }

  > :where(span, div) {
    &:not(.icon) {
      @apply
      inline-flex
      items-center
      px-3
      border
      border-ui-500
      bg-ui-500/75
      text-ui-200
      text-sm
      ;
    }
  }

/*----------------------------*/
/* ICON */
/*----------------------------*/

  > .icon {
    @apply
    absolute
    bottom-[calc(50%-calc(18px/2))]
    left-2.5
    text-lg
    text-ui-300
    pointer-events-none
    ;

    ~ :where(input[type=text], input[type=number], input[type=email], input[type=password], input[type=date], input[type=file], textarea) {
      @apply
      pl-9
      ;
    }

    &.icon-right {
      @apply
      right-2.5
      left-auto
      ;

      ~ input,
      ~ textarea {
        @apply
        pl-2.5
        ;
      }
      ~ input:not([type=date]),
      ~ textarea {
        @apply
        pr-9
        ;
      }
    }
  }

  /* button */

  > :where(button, .button) {
    &:not(.button-primary) {
      @apply
      absolute
      right-0.5
      bottom-0.5
      p-2.5
      ;      
    }

    &.button-sm {
      @apply
      right-0.5
      bottom-[calc(50%-calc(36px/2))]
      ;
    }

    &.button-primary {
      @apply
      whitespace-nowrap
      rounded-l-none
      rounded-r
      order-2
      ;
    }
  }
}

/*----------------------------*/
/* NUMBER */
/*----------------------------*/

.input-number {
  @apply
  relative
  flex
  box-border
  ;

  * {
    @apply
    box-border
    ;
  }

  :where(input) {
    @apply
    flex-1
    relative
    z-0
    w-full
    rounded
    pr-10
    ;
    -moz-appearance: textfield;
    &::-webkit-inner-spin-button,
    &::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
  }

  :where(button) {
    @apply
    outline-none
    bg-ui-800/0
    cursor-pointer
    absolute
    z-30
    right-0
    text-0
    px-1
    border
    border-r-ui-500
    border-l-ui-500/50
    border-t-ui-500
    border-b-ui-500
    hover:bg-ui-600
    duration-300
    ease-in-out
    ;
    -webkit-appearance: none;


    > * {
      @apply
      text-lg
      duration-75
      ease-in-out
      ;
    }
    &:active {
      @apply
      bg-ui-500
      ;
      > * {
        @apply
        scale-110
        text-ui-100
        ;
      }
    }

    &:first-of-type {
      @apply
      top-0
      h-[calc(50%-0.5px)]
      border-b-0
      rounded-tr
      ;
    }
    &:last-of-type {
      @apply
      bottom-0
      border-t-ui-500/50
      h-[calc(50%+0.5px)]
      rounded-br
      ;
    }
  }
}

/*----------------------------*/
/* VALIDATION */
/*----------------------------*/

.form-group {
  &:where([data-error], [data-success], [data-attention]) {
    &::after,
    .form-info {
      @apply
      block
      text-xs
      mt-1
      leading-none
      max-w-[max-content]
      rounded-sm
      absolute
      bg-ui-800/95
      ;
    }
    &:where(:empty, [data-error=true], [data-success=true], [data-attention=true], [data-error=false], [data-success=false], [data-attention=false]) {
      &::after {
        @apply
        hidden
        ;
      }
    }
  }
  
  &[data-error] {
    &::after,
    .form-info {
      @apply
      text-error-500
      ;
    }
    &::after {
      @apply
      content-[attr(data-error)]
      ;
    }
    &.is-loading::before {
      @apply
      border-l-error-700
      ;
    }
    .input-group {
      > :where(span, div) {
        &:not(.icon) {
          @apply
          border-error-700
          ;
        }
      }
    }
    .input-number {
      > button {
        @apply
        border-error-700
        ;
      }
    }
    &:not([data-error=false]) {
      :where(input[type=text], input[type=number], input[type=email], input[type=password], input[type=date], input[type=file], textarea, .input-text, select) {
        @apply
        border-error-700
        focus-visible:outline-error-500
        ;
      }
      :where(.icon, .form-radio, .form-toggle, .form-checkbox) {
        @apply
        text-error-500
        ;
        input {
          &:checked + label::before {
            @apply
            bg-error-500
            from-error-700
            to-error-300
            ;
          }
          & + label::before {
            @apply
            shadow-[0_0_0_2px_rgb(var(--color-error-300))]
          }
        }
      }
    }
  }
  &[data-success] {
    &::after,
    .form-info {
      @apply
      text-interaction-500
      ;
    }
    &::after {
      @apply
      content-[attr(data-success)]
      ;
    }
    &.is-loading::before {
      @apply
      border-l-interaction-700
      ;
    }
    .input-group {
      > :where(span, div) {
        &:not(.icon) {
          @apply
          border-interaction-700
          ;
        }
      }
    }
    .input-number {
      > button {
        @apply
        border-interaction-700
        ;
      }
    }
    &:not([data-success=false]) {
      :where(input[type=text], input[type=number], input[type=email], input[type=password], input[type=date], input[type=file], textarea, .input-text, select) {
        @apply
        border-interaction-700
        focus-visible:outline-interaction-500
        ;
      }
      :where(.icon, .form-radio, .form-toggle, .form-checkbox) {
        @apply
        text-interaction-500
        ;
        input {
          &:checked + label::before {
            @apply
            bg-interaction-500
            from-interaction-700
            to-interaction-300
            ;
          }
          & + label::before {
            @apply
            shadow-[0_0_0_2px_rgb(var(--color-interaction-500))]
          }
        }
      }
    }
  }
  &[data-attention] {
    &::after,
    .form-info {
      @apply
      text-attention-500
      ;
    }
    &::after {
      @apply
      content-[attr(data-attention)]
      ;
    }
    &.is-loading::before {
      @apply
      border-l-attention-700
      ;
    }
    .input-group {
      > :where(span, div) {
        &:not(.icon) {
          @apply
          border-attention-700
          ;
        }
      }
    }
    .input-number {
      > button {
        @apply
        border-attention-700
        ;
      }
    }
    &:not([data-attention=false]) {
      :where(input[type=text], input[type=number], input[type=email], input[type=password], input[type=date], input[type=file], textarea, .input-text, select) {
        @apply
        border-attention-700
        focus-visible:outline-attention-500
        ;
      }
      :where(.icon, .form-radio, .form-toggle, .form-checkbox) {
        @apply
        text-attention-500
        ;
        input {
          &:checked + label::before {
            @apply
            bg-attention-500
            from-attention-700
            to-attention-300
            ;
          }
          & + label::before {
            @apply
            shadow-[0_0_0_2px_rgb(var(--color-attention-300))]
          }
        }
      }
    }
  }


  /* loading */

  &.is-loading {
    @apply
    relative
    ;

    &::before {
      @apply
      content-['']
      absolute
      z-40
      h-6
      w-6
      block
      border-2
      border-ui-800
      border-l-ui-300
      opacity-100
      rounded-full
      mx-auto
      bottom-2.5
      right-2.5
      animate-[input-loader-rotate_1s_linear_infinite]
      ;
    }

    .icon.icon-right {
      @apply
      opacity-0
      ;
    }

    input[type=text],
    input[type=number],
    input[type=email],
    input[type=password],
    input[type=date],
    textarea,
    .input-text {
      @apply
      pr-10
      ;
    }
    select:not([multiple]){
      @apply
      bg-none
      ;
    }
  }
}

@keyframes input-loader-rotate {
  from {
    transform: rotate(0);
  }
  to {
    transform: rotate(360deg);
  }
}

/* disabled */

.form-group.is-disabled input,
.form-group.is-disabled select,
.form-group.is-disabled textarea,
.form-group.is-disabled label,
input[type=text]:disabled,
input[type=number]:disabled,
input[type=email]:disabled,
input[type=password]:disabled,
input[type=date]:disabled,
input[type=file]:disabled,
select:disabled,
textarea:disabled,
.input-text:disabled,
input[type=text].is-disabled,
input[type=number].is-disabled,
input[type=email].is-disabled,
input[type=password].is-disabled,
input[type=date].is-disabled,
input[type=file].is-disabled,
select.is-disabled,
textarea.is-disabled,
.input-text.is-disabled {
  @apply
  opacity-40
  pointer-events-none
  ;
  /* todo apply disabled color treatment */
}
.form-group.is-disabled {
  @apply
  relative
  cursor-not-allowed
  ;
}


/* input date */

input[type=date]::-webkit-calendar-picker-indicator {
  @apply
  opacity-0
  ;
}


/* range */
input[type=range].form-range {
  @apply
  h-4
  w-full
  cursor-pointer
  appearance-none
  overflow-hidden
  rounded-full
  bg-ui-700/0
  ;

  &:focus {
    @apply
    outline-none
    ;
  }

  &:focus-visible {
    &::-webkit-slider-runnable-track {
      --focus-shadow: 0 0 0 6px var(--color-ui-800) inset, 0 0 0 2rem rgb(var(--color-main)) inset
    }
    &::-moz-range-thumb {
      --focus-shadow: 0 0 0 6px var(--color-ui-800) inset, 0 0 0 2rem rgb(var(--color-main)) inset
    }
  }

  &::-webkit-slider-runnable-track {
    @apply
    h-2
    w-full
    rounded-full
    bg-ui-600
    ;
  }

  &::-moz-range-track {
    @apply
    h-2
    w-full
    rounded-full
    bg-ui-600
    ;
  }

  &::-webkit-slider-thumb {
    @apply
    h-4
    w-4
    relative
    top-[50%]
    -translate-y-[50%]
    appearance-none
    border-none
    rounded-full
    text-main
    bg-ui-800
    ;
    --filler-size: 100rem;
    --filler-offset: .5rem;
    box-shadow: 0 0 0 3px rgb(var(--color-main)) inset, var(--focus-shadow, 0 0), calc(var(--filler-size) * -1 - var(--filler-offset)) 0 0 var(--filler-size)
  }

  &::-moz-range-thumb {
    @apply
    h-4
    w-4
    relative
    top-[50%]
    -translate-y-[50%]
    appearance-none
    border-none
    rounded-full
    text-main
    bg-ui-800
    ;
    --filler-size: 100rem;
    --filler-offset: .5rem;
    box-shadow: 0 0 0 3px rgb(var(--color-main)) inset, var(--focus-shadow, 0 0), calc(var(--filler-size) * -1 - var(--filler-offset)) 0 0 var(--filler-size)
  }
}


/* input file dropzone */

.form-dropzone {
  @apply
  flex
  justify-center
  items-center
  w-full
  ;
  > label {
    @apply
    flex
    flex-col
    justify-center
    items-center
    w-full
    bg-ui-700
    rounded
    border
    border-ui-500
    border-dashed
    cursor-pointer
    hover:bg-ui-600
    hover:border-ui-400
    ;

    > div {
      @apply
      flex
      flex-col
      justify-center
      items-center
      text-center
      px-4
      py-8
      text-ui-300
      ;
    }
    > input[type=file] {
      @apply
      hidden
      ;
    }
  }
}

/* number */

@layer utilities {
  input[type="number"] {
    &:not(.is-default) {
      &::-webkit-inner-spin-button,
      &::-webkit-outer-spin-button {
        @apply
        bg-ui-400
        ;
      }
    }
    &.is-nodefault {
      &::-webkit-inner-spin-button,
      &::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }
    }
  }
}